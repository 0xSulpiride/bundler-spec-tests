def is_valid_jsonrpc_response(response):
    assert response["jsonrpc"] == "2.0"
    assert response["id"] == 1234


def requestId(wallet_contract, userOp):
    payload = (
        userOp.sender,
        int(userOp.nonce, 16),
        userOp.initCode,
        userOp.callData,
        int(userOp.callGasLimit, 16),
        int(userOp.verificationGasLimit, 16),
        int(userOp.preVerificationGas, 16),
        int(userOp.maxFeePerGas, 16),
        int(userOp.maxPriorityFeePerGas, 16),
        userOp.paymasterAndData,
        userOp.signature
    )
    return '0x' + wallet_contract.functions.getRequestId(payload).call().hex()


def hash(wallet_contract, userOp):
    payload = (
        userOp.sender,
        int(userOp.nonce, 16),
        userOp.initCode,
        userOp.callData,
        int(userOp.callGasLimit, 16),
        int(userOp.verificationGasLimit, 16),
        int(userOp.preVerificationGas, 16),
        int(userOp.maxFeePerGas, 16),
        int(userOp.maxPriorityFeePerGas, 16),
        userOp.paymasterAndData,
        userOp.signature
    )
    return '0x' + wallet_contract.functions.hash(payload).call().hex()


def assertRpcError(response, message):
    assert response['error']['code'] == -32601
    assert response['error']['message'] == message
